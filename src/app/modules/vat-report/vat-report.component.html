<div class="modern-page-container">
  <!-- Modern Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-title">
        <h1 class="page-title">VAT Report</h1>
        <p class="page-subtitle">
          Manage and track VAT reports with comprehensive auditor details
        </p>
      </div>

      <!-- Navigation Tabs -->
      <nav class="page-navigation">
        <div class="nav-tabs">
          <a
            [routerLink]="['/vat-report']"
            [routerLinkActive]="['active']"
            [routerLinkActiveOptions]="{ exact: true }"
            class="nav-tab"
          >
            <i class="fas fa-file-invoice-dollar"></i>
            <span>VAT Report</span>
          </a>
          <a
            [routerLink]="['/vat-report/vat-request']"
            [routerLinkActive]="['active']"
            [routerLinkActiveOptions]="{ exact: true }"
            class="nav-tab"
          >
            <i class="fas fa-users"></i>
            <span>Auditor List</span>
          </a>
        </div>
      </nav>
    </div>
  </div>

  <!-- Main Content -->
  <div class="page-content">
    <!-- Control Panel -->
    <div class="control-panel">
      <div class="panel-left">
        <!-- Search -->
        <div class="search-container">
          <div class="search-input-wrapper">
            <input
              type="search"
              autocomplete="off"
              [(ngModel)]="searchText"
              placeholder="Search by TRN, Name, or Address..."
              class="search-input"
              [ngModelOptions]="{ standalone: true }"
            />
            <i class="fas fa-search search-icon"></i>
          </div>
        </div>
      </div>

      <div class="panel-right">
        <!-- Month Filter -->
        <div class="filter-select">
          <select
            class="modern-select"
            [(ngModel)]="month"
            (change)="onSelectMonth($event)"
          >
            <option value="" disabled>Select Month</option>
            <option *ngFor="let j of months" [value]="j.month">
              {{ j.month }}
            </option>
          </select>
        </div>

        <!-- Download Button -->
        <button class="download-btn" (click)="reportDownload()">
          <i class="fas fa-download"></i>
          <span>Download Report</span>
        </button>
      </div>
    </div>

    <!-- Data Table -->
    <div class="data-table-container">
      <div class="table-wrapper">
        <table class="modern-table">
          <thead>
            <tr>
              <th class="sortable">
                <div class="th-content">
                  <span>Auditor TRN</span>
                  <i class="fas fa-sort"></i>
                </div>
              </th>
              <th class="sortable">
                <div class="th-content">
                  <span>Auditor Name</span>
                  <i class="fas fa-sort"></i>
                </div>
              </th>
              <th class="sortable">
                <div class="th-content">
                  <span>Auditor Address</span>
                  <i class="fas fa-sort"></i>
                </div>
              </th>
              <th class="sortable">
                <div class="th-content">
                  <span>No of Requests</span>
                  <i class="fas fa-sort"></i>
                </div>
              </th>
              <th class="action-column">Actions</th>
            </tr>
          </thead>
          <tbody>
            <ng-container
              *ngFor="
                let data of complaintsList | filter: searchText;
                let index = index;
                let even = even
              "
            >
              <!-- Main Row -->
              <tr
                class="table-row"
                [class.even-row]="even"
                [class.expanded]="data.showDetail"
              >
                <td class="cell-trn">
                  <div class="cell-content">
                    <span class="trn-badge">{{ data.trn }}</span>
                  </div>
                </td>
                <td class="cell-name">
                  <div class="cell-content">
                    <div class="user-info">
                      <div class="user-avatar">
                        <i class="fas fa-user"></i>
                      </div>
                      <span class="user-name">{{ data.user_name }}</span>
                    </div>
                  </div>
                </td>
                <td class="cell-address">
                  <div class="cell-content">
                    <button
                      class="address-btn"
                      data-toggle="modal"
                      data-target="#userinfo"
                    >
                      <i class="fas fa-map-marker-alt"></i>
                      <span>View Location</span>
                    </button>
                  </div>
                </td>
                <td class="cell-requests">
                  <div class="cell-content">
                    <span class="request-count">{{ data.delay | number }}</span>
                  </div>
                </td>
                <td class="cell-actions">
                  <div class="action-buttons">
                    <button
                      class="expand-btn"
                      [class.expanded]="data.showDetail"
                      (click)="data.showDetail = !data.showDetail"
                    >
                      <i
                        class="fas"
                        [class.fa-chevron-down]="!data.showDetail"
                        [class.fa-chevron-up]="data.showDetail"
                      ></i>
                    </button>
                  </div>
                </td>
              </tr>

              <!-- Expanded Detail Row -->
              <tr class="detail-row" *ngIf="data.showDetail">
                <td colspan="5" class="detail-cell">
                  <div class="detail-container">
                    <div class="detail-header">
                      <h5>Request Details</h5>
                      <span class="detail-count"
                        >{{ complaintsList.length }} records found</span
                      >
                    </div>

                    <div class="detail-table-wrapper">
                      <table class="detail-table">
                        <thead>
                          <tr>
                            <th>TRN</th>
                            <th>Merchant Name</th>
                            <th>Total VAT</th>
                            <th>Total Credit</th>
                            <th>Attachment</th>
                            <th>Delay</th>
                            <th>Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr
                            *ngFor="let detail of complaintsList"
                            class="detail-data-row"
                          >
                            <td>
                              <span class="detail-trn">{{ detail.trn }}</span>
                            </td>
                            <td>
                              <span class="merchant-name">{{
                                detail.user_name
                              }}</span>
                            </td>
                            <td>
                              <span class="amount vat-amount">{{
                                detail.totalVat | number
                              }}</span>
                            </td>
                            <td>
                              <span class="amount credit-amount">{{
                                detail.totCredit | number
                              }}</span>
                            </td>
                            <td>
                              <button
                                class="attachment-btn"
                                data-toggle="modal"
                                data-target="#attachmentModal"
                                (click)="openDialog()"
                              >
                                <i class="fas fa-paperclip"></i>
                                <span>View</span>
                              </button>
                            </td>
                            <td>
                              <span
                                class="delay-badge"
                                [class.high-delay]="detail.delay > 5"
                                [class.medium-delay]="
                                  detail.delay > 2 && detail.delay <= 5
                                "
                                [class.low-delay]="detail.delay <= 2"
                              >
                                {{ detail.delay }} days
                              </span>
                            </td>
                            <td>
                              <button
                                class="reassign-btn"
                                data-toggle="modal"
                                data-target="#reassignModal"
                                (click)="edit(detail)"
                              >
                                <i class="fas fa-user-edit"></i>
                                <span>Reassign</span>
                              </button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>

        <!-- Empty State -->
        <div
          class="empty-state"
          *ngIf="!complaintsList || complaintsList.length === 0"
        >
          <div class="empty-icon">
            <i class="fas fa-file-invoice"></i>
          </div>
          <h3>No VAT Reports Found</h3>
          <p>There are no VAT reports available for the selected criteria.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modern Attachment Modal -->
<div
  class="modal fade modern-modal"
  id="attachmentModal"
  tabindex="-1"
  role="dialog"
>
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-paperclip"></i>
          Attachments
        </h5>
        <button type="button" class="btn-close" data-dismiss="modal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="attachment-carousel">
          <div
            id="attachmentCarousel"
            class="carousel slide"
            data-bs-ride="carousel"
          >
            <div class="carousel-inner">
              <div class="carousel-item active">
                <div class="attachment-item">
                  <img
                    src="assets/images/Cash-Payment-Receipt.png"
                    alt="Receipt 1"
                    class="attachment-image"
                  />
                  <div class="attachment-info">
                    <h6>Cash Payment Receipt - 001</h6>
                    <p>Uploaded: 2024-01-15</p>
                  </div>
                </div>
              </div>
              <div class="carousel-item">
                <div class="attachment-item">
                  <img
                    src="assets/images/Cash-Payment-Receipt_1.png"
                    alt="Receipt 2"
                    class="attachment-image"
                  />
                  <div class="attachment-info">
                    <h6>Cash Payment Receipt - 002</h6>
                    <p>Uploaded: 2024-01-16</p>
                  </div>
                </div>
              </div>
              <div class="carousel-item">
                <div class="attachment-item">
                  <img
                    src="assets/images/Cash-Payment-Receipt_2.png"
                    alt="Receipt 3"
                    class="attachment-image"
                  />
                  <div class="attachment-info">
                    <h6>Cash Payment Receipt - 003</h6>
                    <p>Uploaded: 2024-01-17</p>
                  </div>
                </div>
              </div>
            </div>
            <button
              class="carousel-control-prev"
              type="button"
              data-bs-target="#attachmentCarousel"
              data-bs-slide="prev"
            >
              <span class="carousel-control-prev-icon"></span>
            </button>
            <button
              class="carousel-control-next"
              type="button"
              data-bs-target="#attachmentCarousel"
              data-bs-slide="next"
            >
              <span class="carousel-control-next-icon"></span>
            </button>
            <div class="carousel-indicators">
              <button
                type="button"
                data-bs-target="#attachmentCarousel"
                data-bs-slide-to="0"
                class="active"
              ></button>
              <button
                type="button"
                data-bs-target="#attachmentCarousel"
                data-bs-slide-to="1"
              ></button>
              <button
                type="button"
                data-bs-target="#attachmentCarousel"
                data-bs-slide-to="2"
              ></button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Close
        </button>
        <button type="button" class="btn btn-primary">Download All</button>
      </div>
    </div>
  </div>
</div>

<!-- Modern Reassign Modal -->
<div
  class="modal fade modern-modal"
  id="reassignModal"
  tabindex="-1"
  role="dialog"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-user-edit"></i>
          Reassign Auditor
        </h5>
        <button type="button" class="btn-close" data-dismiss="modal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <form class="reassign-form">
          <div class="form-group">
            <label class="form-label">Select New Auditor</label>
            <select
              class="modern-select"
              (change)="changeStatus($event.target.value)"
            >
              <option value="" disabled selected>Choose an auditor...</option>
              <option *ngFor="let i of auditors" [value]="i.cust_id">
                {{ i.cust_name }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Reason for Reassignment</label>
            <textarea
              class="form-textarea"
              rows="3"
              placeholder="Please provide a reason for reassigning this request..."
            ></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Cancel
        </button>
        <button type="button" class="btn btn-primary">Reassign</button>
      </div>
    </div>
  </div>
</div>
